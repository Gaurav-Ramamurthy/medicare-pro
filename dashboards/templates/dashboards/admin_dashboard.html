{% extends "core/base.html" %}
{% load tz %}
{% load humanize %}
{% load static %}

{% block title %}Admin Dashboard | MediCare Pro{% endblock %}

{% block content %}
<div class="modern-admin-dashboard">
  <!-- Top Header with Cyan Background -->
  <div class="dashboard-top-header">
    <div class="header-left">
      <h1>Dashboard</h1>
      <p class="subtitle">Real-time overview based on actual database records â€¢ {{ today|date:"m/d/Y" }}</p>
    </div>
    <div class="header-actions">
      {% if user.is_superuser or user.role == 'admin' %}
        <a href="{% url 'create_user' %}" class="btn-cyan">
          Add User
        </a>
        <a href="/admin/" class="btn-cyan-outline">Django Admin</a>
      {% endif %}
      <a href="{% url 'contact_queries' %}" class="btn-cyan-outline">Query Section</a>
    </div>
  </div>

  <!-- Stats Cards Row -->
  <div class="stats-row">
    <div class="stat-box stat-admins">
      <div class="stat-label">ADMINS</div>
      <div class="stat-number">{{ total_admins|default:0 }}</div>
      <div class="stat-change {{ admins_growth_class }}">{{ admins_growth_pct }}% {{ admins_growth_icon }}</div>
    </div>
    <div class="stat-box stat-doctors">
      <div class="stat-label">DOCTORS</div>
      <div class="stat-number">{{ active_doctors|default:0 }}</div>
      <div class="stat-change {{ doctors_growth_class }}">{{ doctors_growth_pct }}% {{ doctors_growth_icon }}</div>
    </div>
    <div class="stat-box stat-receptionists">
      <div class="stat-label">RECEPTIONISTS</div>
      <div class="stat-number">{{ total_receptionists|default:0 }}</div>
      <div class="stat-change {{ receptionists_growth_class }}">{{ receptionists_growth_pct }}% {{ receptionists_growth_icon }}</div>
    </div>
    <div class="stat-box stat-patients">
      <div class="stat-label">PATIENTS</div>
      <div class="stat-number">{{ total_patients|default:0 }}</div>
      <div class="stat-change {{ patients_growth_class }}">{{ patients_growth_pct }}% {{ patients_growth_icon }}</div>
    </div>
    <div class="stat-box stat-appointments">
      <div class="stat-label">APPOINTMENTS</div>
      <div class="stat-number">{{ total_appointments|default:0 }}</div>
      <div class="stat-change {{ appointments_growth_class }}">{{ appointments_growth_pct }}% {{ appointments_growth_icon }}</div>
    </div>
    <div class="stat-box stat-today">
      <div class="stat-label">TODAY'S APPOINTMENTS</div>
      <div class="stat-number">{{ today_appointments_count|default:0 }}</div>
      <div class="stat-change {{ today_growth_class }}">{{ today_appointments_growth_pct }}% {{ today_growth_icon }}</div>
    </div>
  </div>

  <!-- Real Database Analytics Section -->
  <div class="analytics-section">
    <div class="section-header">
      <div class="section-title">
        <span class="icon">ðŸ“Š</span>
        <h2>Real Database Analytics</h2>
      </div>
      <p class="section-subtitle">Live data from your actual patients and appointments â€¢ Based on createdAt timestamps</p>
    </div>

    <!-- Charts Grid (Patient Growth + Weekly Appointments) -->
    <div class="charts-grid-two">
      <!-- Patient Growth Chart -->
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">
            <span class="chart-icon">ðŸ“ˆ</span>
            <h3>Real Patient Growth</h3>
          </div>
          <span class="badge-db">Database Data</span>
        </div>
        <div class="chart-container">
          <canvas id="patientGrowthChart"></canvas>
        </div>
      </div>
      <!-- Weekly Appointments Chart -->
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">
            <span class="chart-icon">ðŸ“…</span>
            <h3>This Week's Appointments</h3>
          </div>
          <span class="badge-live">Live Data</span>
        </div>
        <div class="chart-container">
          <canvas id="weeklyAppointmentsChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Appointment Status Chart (Yearly Stacked Bar Chart) -->
  <div class="appointment-status-section">
    <div class="chart-card-full">
      <div class="chart-header-main">
        <h2>Appointment Status Overview</h2>
        <p class="chart-subtitle">Full year appointment trends for 2025 â€¢ Real database data</p>
      </div>
      <div class="chart-container-large">
        <canvas id="yearlyAppointmentChart"></canvas>
      </div>
      <div class="chart-legend-custom">
        <div class="legend-item">
          <span class="legend-color" style="background: #5856D6;"></span>
          <span>Scheduled</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background: #34C759;"></span>
          <span>Completed</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background: #FF3B30;"></span>
          <span>Cancelled</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Section: Total Beneficiaries + Bookings by Source -->
  <div class="dashboard-bottom-row">
    <div class="beneficiaries-card colorful-bars">
      <div class="card-header-section">
        <h2>Total Beneficiaries</h2>
        <span class="badge-current">Current Stats</span>
      </div>
        <div class="beneficiary-bars-list">
          <div class="beneficiary-bar-row">
            <span class="b-label">Admins</span>
            <div class="b-bar-bg bar-purple">
              <div class="b-bar-fill bar-purple" style="width: {% widthratio total_admins 10 100 %}%;"></div>
              <span class="b-nums b-purple">{{ total_admins|default:0 }}/10</span>
            </div>
          </div>

          <div class="beneficiary-bar-row">
            <span class="b-label">Doctors</span>
            <div class="b-bar-bg bar-blue">
              <div class="b-bar-fill bar-blue" style="width: {% widthratio active_doctors 20 100 %}%;"></div>
              <span class="b-nums b-blue">{{ active_doctors|default:0 }}/20</span>
            </div>
          </div>

          <div class="beneficiary-bar-row">
            <span class="b-label">Receptionists</span>
            <div class="b-bar-bg bar-orange">
              <div class="b-bar-fill bar-orange" style="width: {% widthratio total_receptionists 15 100 %}%;"></div>
              <span class="b-nums b-orange">{{ total_receptionists|default:0 }}/15</span>
            </div>
          </div>

          <div class="beneficiary-bar-row">
            <span class="b-label">Patients</span>
            <div class="b-bar-bg bar-green">
              <div class="b-bar-fill bar-green" style="width: {% widthratio total_patients 100 100 %}%;"></div>
              <span class="b-nums b-green">{{ total_patients|default:0 }}/100</span>
            </div>
          </div>

          <div class="beneficiary-bar-row">
            <span class="b-label">Appointments</span>
            <div class="b-bar-bg bar-teal">
              <div class="b-bar-fill bar-teal" style="width: {% widthratio total_appointments 200 100 %}%;"></div>
              <span class="b-nums b-teal">{{ total_appointments|default:0 }}/200</span>
            </div>
          </div>

          <div class="beneficiary-bar-row">
            <span class="b-label">Today</span>
            <div class="b-bar-bg bar-today">
              <div class="b-bar-fill bar-today" style="width: {% widthratio today_appointments_count 40 100 %}%;"></div>
              <span class="b-nums b-today">{{ today_appointments_count|default:0 }}/40</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

.modern-admin-dashboard {
  background: #f5f7fa;
  min-height: 100vh;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.dashboard-bottom-row {
  max-width: 1600px;
  margin: auto;
  padding: 0 20px;
}

/* Top Cyan Header */
.dashboard-top-header {
  background: linear-gradient(135deg, #00bcd4 0%, #00acc1 100%);
  padding: 28px 32px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: white;
  box-shadow: 0 4px 12px rgba(0, 188, 212, 0.15);
  margin: 0 20px 24px;
  border-radius: 12px;
}

.header-left h1 {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 6px;
  color: white;
}

.subtitle {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.9);
  font-weight: 500;
}

.header-actions {
  display: flex;
  gap: 12px;
}

.btn-cyan {
  background: white;
  color: #00bcd4;
  padding: 11px 24px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
  font-size: 14px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border: 2px solid white;
  cursor: pointer;
}

.btn-cyan:hover {
  background: rgba(255, 255, 255, 0.95);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
}

.btn-cyan-outline {
  background: transparent;
  color: white;
  padding: 11px 24px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
  font-size: 14px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
}

.btn-cyan-outline:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.5);
  transform: translateY(-2px);
}

/* Stats Row */
.stats-row {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 18px;
  padding: 0 20px 24px;
}

.stat-box {
  background: white;
  padding: 22px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border-left: 5px solid #ddd;
}

.stat-box:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}

.stat-label {
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.6px;
  color: #999;
  margin-bottom: 10px;
  text-transform: uppercase;
}

.stat-number {
  font-size: 40px;
  font-weight: 800;
  margin-bottom: 8px;
}

.stat-change {
  font-size: 13px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 4px;
}

.stat-change.positive {
  color: #00bcd4;
}

.stat-change.negative {
  color: #ff3b30;
}

.stat-change.neutral {
  color: #999;
}

.stat-badge {
  display: inline-block;
  background: #e0f7fa;
  color: #00acc1;
  padding: 5px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
}

.stat-admins { border-left-color: #6a1b9a; }
.stat-admins .stat-number { color: #4a148c; }

.stat-doctors { border-left-color: #1976d2; }
.stat-doctors .stat-number { color: #0d47a1; }

.stat-receptionists { border-left-color: #f57c00; }
.stat-receptionists .stat-number { color: #e65100; }

.stat-patients { border-left-color: #388e3c; }
.stat-patients .stat-number { color: #2e7d32; }

.stat-appointments { border-left-color: #52ddeaff; }
.stat-appointments .stat-number { color: #07d6c5ff; }

.stat-today { border-left-color: #d10202ff; }
.stat-today .stat-number { color: #d91212ff; }

/* Admins â€“ matches .stat-admins */
.b-bar-bg.bar-purple { background: #e1bee7; }
.b-bar-fill.bar-purple { background: #6a1b9a; }
.b-purple { color: #4a148c; }

/* Doctors â€“ matches .stat-doctors */
.b-bar-bg.bar-blue { background: #bbdefb; }
.b-bar-fill.bar-blue { background: #1976d2; }
.b-blue { color: #0d47a1; }

/* Receptionists â€“ matches .stat-receptionists */
.b-bar-bg.bar-orange { background: #ffe0b2; }
.b-bar-fill.bar-orange { background: #f57c00; }
.b-orange { color: #e65100; }

/* Patients â€“ matches .stat-patients */
.b-bar-bg.bar-green { background: #c8e6c9; }
.b-bar-fill.bar-green { background: #388e3c; }
.b-green { color: #2e7d32; }

/* Appointments â€“ matches .stat-appointments */
.stat-appointments { border-left-color: #06b6d4; }
.stat-appointments .stat-number { color: #0891b2; }
.b-teal { color: #a7f3f0; }

/* Today â€“ keep separate highlight color */
.b-bar-bg.bar-today { background: #fcb3b3ff; }
.b-bar-fill.bar-today { background: #df0808ff; }
.b-today { color: #cf0505ff; }
  

/* Analytics Section */
.analytics-section {
  padding: 0 20px 24px;
}

.section-header {
  background: white;
  padding: 22px;
  border-radius: 12px;
  margin-bottom: 18px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.section-title {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 6px;
}

.section-title .icon {
  font-size: 28px;
}

.section-title h2 {
  font-size: 22px;
  font-weight: 700;
  color: #0f172a;
}

.section-subtitle {
  font-size: 13px;
  color: #666;
  margin-left: 40px;
}

/* Charts Grid */
.charts-grid-two {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 18px;
}

.chart-card {
  background: white;
  border-radius: 12px;
  padding: 22px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.chart-card:hover {
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
  transform: translateY(-2px);
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 18px;
}

.chart-title {
  display: flex;
  align-items: center;
  gap: 10px;
}

.chart-icon {
  font-size: 20px;
}

.chart-title h3 {
  font-size: 17px;
  font-weight: 600;
  color: #0f172a;
}

.badge-db {
  background: #e0f7fa;
  color: #00acc1;
  padding: 6px 14px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 700;
}

.badge-live {
  background: #e8f5e9;
  color: #4caf50;
  padding: 6px 14px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 700;
}

.chart-container {
  height: 280px;
  position: relative;
}

/* Appointment Status Chart */
.appointment-status-section {
  padding: 0 20px 24px;
}

.chart-card-full {
  background: white;
  border-radius: 12px;
  padding: 28px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  transition: all 0.3s;
}

.chart-card-full:hover {
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
}

.chart-header-main h2 {
  font-size: 22px;
  font-weight: 700;
  color: #0f172a;
  margin-bottom: 4px;
}

.chart-subtitle {
  font-size: 13px;
  color: #666;
  margin-bottom: 22px;
}

.chart-container-large {
  height: 320px;
  position: relative;
  margin-bottom: 20px;
}

.chart-legend-custom {
  display: flex;
  justify-content: center;
  gap: 32px;
  padding-top: 16px;
  border-top: 1px solid #f0f0f0;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: #666;
  font-weight: 600;
}

.legend-color {
  width: 14px;
  height: 14px;
  border-radius: 3px;
}

/* Bottom Grid */
.bottom-grid {
  display: grid;
  grid-template-columns: 1fr 400px;
  gap: 18px;
  padding: 0 20px 40px;
}

.beneficiaries-card {
  background: white;
  border-radius: 12px;
  padding: 26px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  transition: all 0.3s;
}

.beneficiaries-card:hover {
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
}

.card-header-section {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 22px;
  padding-bottom: 12px;
  border-bottom: 1px solid #f5f5f5;
}

.card-header-section h2 {
  font-size: 19px;
  font-weight: 700;
  color: #0f172a;
}

.badge-current {
  background: #e0f7fa;
  color: #00acc1;
  padding: 6px 14px;
  border-radius: 13px;
  font-size: 12px;
  font-weight: 700;
  margin-left: 6px;
}

.beneficiary-bars-list {
  margin-top: 24px;
  display: flex;
  flex-direction: column;
  gap: 22px;
}

.beneficiary-bar-row {
  display: flex;
  align-items: center;
  gap: 20px;
}

.b-label {
  min-width: 120px;
  font-size: 1.06rem;
  color: #21262d;
  font-weight: 560;
  text-align: left;
}

.b-bar-bg {
  position: relative;
  flex: 1 1 auto;
  background: #f0f7fa;
  height: 19px;
  border-radius: 9px;
  overflow: hidden;
  display: flex;
  align-items: center;
}

.b-bar-fill {
  position: absolute;
  left: 0; top: 0; height: 100%;
  border-radius: 9px;
}

/* Background colors for beneficiary bars */
.bar-purple  { background: #e1bee7 !important; }
.bar-blue    { background: #bbdefb !important; }
.bar-orange  { background: #ffe0b2 !important; }
.bar-green   { background: #c8e6c9 !important; }
.bar-teal    { background: #a7f3f0 !important; }
.bar-today   { background: #f5cdcdff !important; }
/* Fill colors for beneficiary bars */
.b-bar-fill.bar-purple  { background: #6a1b9a !important;; }
.b-bar-fill.bar-blue    { background: #1976d2 !important;; }
.b-bar-fill.bar-orange  { background: #f57c00 !important;; }
.b-bar-fill.bar-green   { background: #388e3c !important;; }
.b-bar-fill.bar-teal    { background: #06b6d4 !important;; }
.b-bar-fill.bar-today   { background: #c70b0bff !important;; }
/* Text colors for numbers on beneficiary bars */
.b-purple { color: #4a148c !important; }
.b-blue   { color: #0d47a1 !important; }
.b-orange { color: #e65100 !important; }
.b-green  { color: #2e7d32 !important; }
.b-teal   { color: #0891b2 !important; }
.b-today  { color: #b60303ff !important; }

/* Positioning and font styling for numbers on bars */
.b-nums {
  position: absolute;
  right: 12px;
  top: 0; height: 100%;
  display: flex; align-items: center;
  font-weight: 700;
  font-size: 1.02rem;
}

/* Responsive Design */
@media (max-width: 1400px) {
  .stats-row {
    grid-template-columns: repeat(3, 1fr);
  }
  .charts-grid-two {
    grid-template-columns: 1fr;
  }
  .bottom-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 1024px) {
  .stats-row {
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
  .dashboard-top-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
    padding: 20px 24px;
  }
  .header-actions {
    width: 100%;
    flex-direction: column;
  }
  .btn-cyan, .btn-cyan-outline {
    width: 100%;
    text-align: center;
  }
  .chart-container-large {
    height: 280px;
  }
}

@media (max-width: 768px) {
  .stats-row {
    grid-template-columns: 1fr;
    gap: 12px;
    padding: 0 16px 18px;
  }
  .dashboard-top-header {
    margin: 0 16px 18px;
    padding: 18px 20px;
    border-radius: 12px;
  }
  .header-left h1 {
    font-size: 24px;
  }
  .subtitle {
    font-size: 12px;
  }
  .header-actions {
    gap: 8px;
  }
  .btn-cyan, .btn-cyan-outline {
    padding: 10px 16px;
    font-size: 13px;
  }
  .charts-grid-two {
    gap: 16px;
  }
  .chart-card {
    padding: 18px;
  }
  .chart-container {
    height: 240px;
  }
  .analytics-section,
  .appointment-status-section {
    padding: 0 16px 18px;
  }
  .section-header {
    padding: 18px;
  }
  .section-title h2 {
    font-size: 19px;
  }
  .section-subtitle {
    font-size: 12px;
    margin-left: 36px;
  }
  .chart-card-full {
    padding: 20px;
  }
  .chart-container-large {
    height: 260px;
  }
  .chart-legend-custom {
    gap: 16px;
  }
  .bottom-grid {
    padding: 0 16px 30px;
  }
  .beneficiaries-card,
  .bookings-card {
    padding: 20px;
  }
}

@media (max-width: 480px) {
  .stats-row {
    grid-template-columns: 1fr;
    gap: 10px;
    padding: 0 12px 16px;
  }
  .dashboard-top-header {
    margin: 0 12px 16px;
    padding: 16px 16px;
    border-radius: 8px;
  }
  .header-left h1 {
    font-size: 20px;
  }
  .subtitle {
    font-size: 11px;
  }
  .stat-box {
    padding: 16px;
  }
  .stat-label {
    font-size: 10px;
  }
  .stat-number {
    font-size: 32px;
  }
  .chart-container {
    height: 200px;
  }
  .chart-container-large {
    height: 220px;
  }
  .analytics-section,
  .appointment-status-section {
    padding: 0 12px 16px;
  }
  .chart-legend-custom {
    flex-direction: column;
    gap: 10px;
    align-items: center;
  }
  .bottom-grid {
    padding: 0 12px 24px 12px;
  }
  .beneficiaries-card,
  .bookings-card {
    padding: 16px;
  }
}

/* Additional Colors for Receptionists */
.stat-receptionists { border-left-color: #ff9800; }
.stat-receptionists .stat-number { color: #f57c00; }

.b-bar-bg.bar-green { background: #ffcdcdff; }
.b-bar-fill.bar-green { background: #ff0707ff; }
.b-green { color: #ff9800; }
</style>

<!-- Pass Django data to JavaScript -->
<script id="chart-data" type="application/json">
{
    "patientGrowthData": {{ patient_growth_data|safe }},
    "weeklyAppointmentsData": {{ weekly_appointments_data|safe }},
    "monthlyStats": {{ monthly_stats|safe }}
}
</script>

<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
console.log("=== CHART DEBUG ===");
console.log("Chart.js loaded?", typeof Chart !== 'undefined');

let chartData = {
    patientGrowthData: [0, 0, 0, 0],
    weeklyAppointmentsData: [0, 0, 0, 0, 0, 0, 0],
    monthlyStats: []
};

try {
    const dataElement = document.getElementById('chart-data');
    if (dataElement) {
        const jsonText = dataElement.textContent.trim();
        chartData = JSON.parse(jsonText);
        console.log("âœ… Chart data parsed successfully!");
    } else {
        console.error("âŒ chart-data element not found!");
    }
} catch (e) {
    console.error("âŒ Error parsing chart data:", e);
}

const patientGrowthData = Array.isArray(chartData.patientGrowthData) && chartData.patientGrowthData.length > 0 
    ? chartData.patientGrowthData 
    : [0, 0, 0, 0];

const weeklyAppointmentsData = Array.isArray(chartData.weeklyAppointmentsData) && chartData.weeklyAppointmentsData.length > 0 
    ? chartData.weeklyAppointmentsData 
    : [0, 0, 0, 0, 0, 0, 0];

let monthlyStats = Array.isArray(chartData.monthlyStats) && chartData.monthlyStats.length > 0 
    ? chartData.monthlyStats 
    : [];

if (monthlyStats.length === 0) {
    monthlyStats = Array(12).fill(0).map((_, i) => ({
        month: i + 1,
        scheduled: 0,
        completed: 0,
        cancelled: 0
    }));
}

// Patient Growth Chart
const patientCtx = document.getElementById('patientGrowthChart');
if (patientCtx) {
    new Chart(patientCtx.getContext('2d'), {
        type: 'line',
        data: {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
            datasets: [{
                label: 'Patients',
                data: patientGrowthData,
                borderColor: '#00bcd4',
                backgroundColor: 'rgba(0, 188, 212, 0.08)',
                borderWidth: 3,
                pointRadius: 5,
                pointBackgroundColor: '#00bcd4',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 },
                    borderColor: '#00bcd4',
                    borderWidth: 1
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { stepSize: 5, font: { size: 11 }, color: '#999' },
                    grid: { color: 'rgba(0, 0, 0, 0.03)', drawBorder: false }
                },
                x: {
                    ticks: { font: { size: 11 }, color: '#999' },
                    grid: { display: false }
                }
            }
        }
    });
}

// Weekly Appointments Chart
const appointmentCtx = document.getElementById('weeklyAppointmentsChart');
if (appointmentCtx) {
    new Chart(appointmentCtx.getContext('2d'), {
        type: 'bar',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Appointments',
                data: weeklyAppointmentsData,
                backgroundColor: 'rgba(0, 188, 212, 0.7)',
                borderColor: '#00bcd4',
                borderWidth: 2,
                borderRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 },
                    borderColor: '#00bcd4',
                    borderWidth: 1
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { stepSize: 1, font: { size: 11 }, color: '#999' },
                    grid: { color: 'rgba(0, 0, 0, 0.03)', drawBorder: false }
                },
                x: {
                    ticks: { font: { size: 11 }, color: '#999' },
                    grid: { display: false }
                }
            }
        }
    });
}

// Yearly Appointment Chart
const yearlyCtx = document.getElementById('yearlyAppointmentChart');
if (yearlyCtx) {
    const scheduledData = monthlyStats.map(stat => stat.scheduled || 0);
    const completedData = monthlyStats.map(stat => stat.completed || 0);
    const cancelledData = monthlyStats.map(stat => stat.cancelled || 0);

    new Chart(yearlyCtx.getContext('2d'), {
        type: 'bar',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [
                {
                    label: 'Scheduled',
                    data: scheduledData,
                    backgroundColor: '#5856D6',
                    borderRadius: 0,
                    barThickness: 35
                },
                {
                    label: 'Completed',
                    data: completedData,
                    backgroundColor: '#34C759',
                    borderRadius: 0,
                    barThickness: 35
                },
                {
                    label: 'Cancelled',
                    data: cancelledData,
                    backgroundColor: '#FF3B30',
                    borderRadius: 0,
                    barThickness: 35
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 },
                    borderColor: '#00bcd4',
                    borderWidth: 1
                }
            },
            scales: {
                x: {
                    stacked: true,
                    ticks: { font: { size: 11 }, color: '#999' },
                    grid: { display: false }
                },
                y: {
                    stacked: true,
                    beginAtZero: true,
                    ticks: { stepSize: 5, font: { size: 11 }, color: '#999' },
                    grid: { color: 'rgba(0, 0, 0, 0.03)', drawBorder: false }
                }
            }
        }
    });
}

console.log("=== ALL CHARTS CREATED ===");

// Auto-refresh every 30 seconds
setInterval(function() {
    location.reload();
}, 30000);
</script>

{% endblock %}
